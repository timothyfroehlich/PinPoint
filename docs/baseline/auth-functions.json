{
  "inventoryDate": "2025-01-04",
  "totalFunctions": 12,
  "patterns": {
    "context": ["getRequestAuthContext", "getOrganizationContext", "getDALAuthContext", "getUploadAuthContext"],
    "requirement": ["requireAuthorized", "requireMemberAccess", "requireOrganizationContext"],
    "action": ["getActionAuthContext", "getServerAuthContext", "requireActionAuthContextWithPermission"],
    "supabase": ["requireSupabaseUserContext"],
    "rls": ["getUserWithOrganization"]
  },
  "functions": [
    {
      "name": "getRequestAuthContext",
      "location": "src/server/auth/context.ts:64",
      "pattern": "context",
      "usageCount": 95,
      "callSites": [
        "src/app/layout.tsx:20",
        "src/app/machines/page.tsx:77",
        "src/server/context/request-context.ts:55",
        "src/app/settings/page.tsx:29",
        "src/app/settings/layout.tsx:27",
        "src/app/issues/page.tsx:175",
        "src/lib/organization-context.ts:45",
        "src/app/settings/activity/page.tsx:38",
        "src/lib/settings/organization-actions.ts:13",
        "src/server/observability/logger.ts:94",
        "src/app/settings/system/page.tsx:33",
        "src/app/machines/new/page.tsx:20",
        "src/app/machines/[id]/page.tsx:25",
        "src/app/machines/[id]/page.tsx:53",
        "src/app/search/page.tsx:43",
        "src/app/settings/organization/page.tsx:28",
        "src/app/settings/roles/page.tsx:76",
        "src/app/dashboard/page.tsx:31",
        "src/app/settings/users/page.tsx:25",
        "src/app/auth/sign-up/page.tsx:19",
        "src/app/issues/create/page.tsx:84",
        "src/app/auth/sign-in/page.tsx:19",
        "src/app/issues/[issueId]/page.tsx:30",
        "src/lib/actions/notification-actions.ts:65",
        "src/lib/actions/notification-actions.ts:127",
        "src/lib/actions/notification-actions.ts:202",
        "src/lib/actions/notification-actions.ts:263",
        "src/app/api/search/universal/route.ts:58",
        "src/app/api/search/suggestions/route.ts:22",
        "src/lib/actions/machine-actions.ts:71",
        "src/lib/actions/machine-actions.ts:126",
        "src/lib/actions/machine-actions.ts:191",
        "src/lib/actions/machine-actions.ts:248",
        "src/lib/actions/machine-actions.ts:319",
        "src/lib/actions/machine-actions.ts:395",
        "src/lib/actions/machine-actions.ts:466",
        "src/lib/actions/shared.ts:42",
        "src/lib/actions/shared.ts:67",
        "src/lib/actions/comment-actions.ts:74",
        "src/lib/actions/comment-actions.ts:153",
        "src/lib/actions/comment-actions.ts:219",
        "src/lib/actions/comment-actions.ts:278",
        "src/lib/actions/issue-actions.ts:109",
        "src/lib/actions/issue-actions.ts:354",
        "src/lib/actions/issue-actions.ts:435",
        "src/lib/actions/issue-actions.ts:508",
        "src/lib/actions/issue-actions.ts:605",
        "src/lib/actions/organization-actions.ts:71",
        "src/lib/actions/organization-actions.ts:145",
        "src/lib/actions/admin-actions.ts:96",
        "src/lib/actions/admin-actions.ts:267",
        "src/lib/actions/admin-actions.ts:354",
        "src/lib/actions/admin-actions.ts:437",
        "src/lib/actions/admin-actions.ts:530",
        "src/components/search/universal-search-results.tsx:82"
      ],
      "description": "Canonical authentication resolver - returns discriminated union, never throws"
    },
    {
      "name": "requireAuthorized",
      "location": "src/server/auth/context.ts:146",
      "pattern": "requirement",
      "usageCount": 3,
      "callSites": [
        "src/lib/organization-context.ts:69",
        "src/lib/organization-context.ts:89",
        "src/lib/organization-context.ts:156"
      ],
      "description": "Legacy enforcement helper - throws if not authorized"
    },
    {
      "name": "requireMemberAccess",
      "location": "src/lib/organization-context.ts:88",
      "pattern": "requirement",
      "usageCount": 1,
      "callSites": [
        "src/app/settings/layout.tsx:32"
      ],
      "description": "Legacy wrapper around canonical resolver - heavily used historically"
    },
    {
      "name": "getOrganizationContext",
      "location": "src/lib/organization-context.ts:44",
      "pattern": "context",
      "usageCount": 1,
      "callSites": [],
      "description": "Legacy wrapper around canonical resolver - returns null if no context"
    },
    {
      "name": "requireOrganizationContext",
      "location": "src/lib/organization-context.ts:68",
      "pattern": "requirement",
      "usageCount": 2,
      "callSites": [
        "src/lib/organization-context.ts:138",
        "src/lib/organization-context.ts:156"
      ],
      "description": "Legacy wrapper around canonical resolver - throws if no context"
    },
    {
      "name": "getActionAuthContext",
      "location": "src/lib/actions/shared.ts:29",
      "pattern": "action",
      "usageCount": 1,
      "callSites": [],
      "description": "Server Action authentication context with redirect handling"
    },
    {
      "name": "getServerAuthContext",
      "location": "src/lib/actions/shared.ts:54",
      "pattern": "action",
      "usageCount": 0,
      "callSites": [],
      "description": "Alias for getActionAuthContext - DAL compatibility"
    },
    {
      "name": "requireActionAuthContextWithPermission",
      "location": "src/lib/actions/shared.ts:60",
      "pattern": "action",
      "usageCount": 0,
      "callSites": [],
      "description": "Combined auth + permission check for Server Actions"
    },
    {
      "name": "getDALAuthContext",
      "location": "src/lib/dal/shared.ts:20",
      "pattern": "context",
      "usageCount": 0,
      "callSites": [],
      "description": "Pure auth context without organizational dependencies"
    },
    {
      "name": "requireSupabaseUserContext",
      "location": "src/lib/supabase/server.ts:195",
      "pattern": "supabase",
      "usageCount": 0,
      "callSites": [],
      "description": "Supabase-specific user context with organizationId from app_metadata"
    },
    {
      "name": "getUserWithOrganization",
      "location": "src/lib/supabase/rls-helpers.ts:119",
      "pattern": "rls",
      "usageCount": 3,
      "callSites": [
        "src/lib/supabase/multi-tenant-client.ts:65",
        "src/lib/supabase/rls-helpers.ts:202"
      ],
      "description": "RLS helper for organization scoping and database session setup"
    },
    {
      "name": "getUploadAuthContext",
      "location": "src/server/auth/uploadAuth.ts:53",
      "pattern": "context",
      "usageCount": 0,
      "callSites": [],
      "description": "Upload-specific authentication context for file operations"
    }
  ],
  "highUsageFunctions": [
    {
      "name": "getRequestAuthContext",
      "usageCount": 95,
      "pattern": "context"
    }
  ],
  "duplicateNames": [],
  "migrationStatus": {
    "canonicalResolver": "getRequestAuthContext",
    "legacyWrappers": ["requireMemberAccess", "getOrganizationContext", "requireOrganizationContext"],
    "migrationProgress": "Phase 1A - Legacy wrappers point to canonical resolver",
    "remainingMigrations": [
      "Replace direct legacy wrapper calls with canonical resolver",
      "Migrate specialized contexts (action, supabase, upload) to canonical pattern",
      "Remove legacy wrapper functions after migration complete"
    ]
  },
  "instrumentationIntegration": {
    "trackingFunction": "trackAuthResolverCall",
    "location": "src/lib/auth/instrumentation.ts:22",
    "metricsEndpoint": "src/app/api/_internal/auth-metrics/route.ts",
    "trackedResolvers": ["getRequestAuthContext"]
  }
}
