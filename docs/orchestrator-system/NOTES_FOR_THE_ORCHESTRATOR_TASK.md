There's a significant amount of reduncancy between the system prompt, task template and root CLAUDE.md. Both the orchestrator and subagents will always automatically read the root CLAUDE.md. It should be the SoT for all guidance for code quality, system architecture and so on.

Have the orchestrator identify existing docs (in docs/) that the subagent should read before starting their work.

New thing for the orchestrator - I want it to follow test driven development, and to prepare three seperate agents. The first will create the tests, the second will do the implementation, iterating until the tests pass and no other tests are broken, and the review agent will review the code after it's been put up for a PR. The test agent will commit once it's done (with `--no-verify` if needed), and the implementation agent will commit, push and put up the PR before it's done. It will wait until all github actions have completed and are passing before declaring its job done. If it sees an action that's failing, it will check why and create a plan to address the failure, along with an explanation for why the failure wasn't caught before pushing the PR.

The Orchestrator should make sure that it calls out the specific cujs that are relevant to the task and that the test agent should make sure it implements.

The review agent will (obviously) review, including considering the validity of other review comments that were posted on the PR (usually from GitHub Copilot). Once everything is addressed I will make the final approval and the agent will set the PR to auto-merge, then wait for up to five minutes for the github actions to finish and the auto-merge to happen. If an action fails then identify the failure, create a plan to address it, and an explanation for why it wasn't caught before.

I'd also like you to split the four role's descriptions into two files, one that is generic to any software coding project and another that is specific to the project we're in (in this case, PinPoint). The generic ones should @ include the project-specific ones. The generic ones will probably be hosted in my global ~/.claude/agents directory and the project specific ones should all be in the project's .claude/agents. Have the project-specific ones use the filename <agent>-project.md, to help keep things unambiguous. Does it make sense to have the generic ones be ~/.claude/command files? Check the documentation for custom commands.
To be clear, each subagent should be started with a prompt to read it's instructions file that the orchestrator created, and that instructions file would start by telling the subagent to also read it's specific global and project-specific agents files.

For the Orchestrator, one of it's tasks when a subagent's task is complete and merged is to do a quick review and update of any documentation, incorporating any changes that were made that deviated from existing documentation and marking pending tasks as complete. It should also do a check of the open GitHub issues and close/update any that need it. Just scan through the names of the issues, don't need to read all of them.

I also want the Orchestrator to maintain two files which are maps of the source and tests repeatedly. The source map should be grouped by subsystem/purpose (such as issue creation or pinballmap integration) and include all files that contribute to that subsystem, as well as test files for that subsystem. The goal is to group all of the files that contribute to the front-end and back-end portions of specific subsystems/features, so an agent working on that subsystem can find them all quickly. Don't repeat common files (like the prisma schema) into every entry, just have them mentioned as core common files. The test map should be a map of each test file back to the files it's specifically testing. Group the different types (integration/unit/e2e) together. These should be in the docs/architecture directory, and the orchestrator should update them as part of its subagent task completion project.

Can I commit MCP tool configuration to a project's repo? Does Claude Code support that? Do a web search for the latest Claude documentation.

Let's consider the docs/backend_impl_tasks/MULTI_AGENT_WORKFLOW.md file and how it fits in with the Orchestrator system. It's basically the prototype for the Orchestrator system. Perhaps it can serve as a common base for the documentation for all four agent types. Can it live in the main ~/.claude directory and be referenced by the other files? I only want it to be read when I'm actually invoking one of my agents, instead of with every single claude code instance.

Do some investigation into Claudia (~/Code/claudia) and how this system can be set up in Claudia.

docs/architecture/current-state.md states that we have a shared database with careful scoping, it's not trying to imply that we have a shared database with between all of the subagents/worktrees, right? We should update it to remove information that's already present in the project's CLAUDE.md
