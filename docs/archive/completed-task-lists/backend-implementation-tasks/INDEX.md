# Index of docs/backend_impl_tasks/completed

This directory contains documentation for backend implementation tasks that have been successfully completed. Each document details the objective, implementation steps, and validation for a specific task, serving as a record of completed work.

- **[00-setup-feature-branch.md](./00-setup-feature-branch.md)**: This document outlines the initial setup of the main feature branch for the Phase 1A backend refactor and establishes the PR-based workflow for individual task implementation. It details steps for creating and pushing the feature branch, committing the initial task structure, and setting up the GitHub issue for Phase 1A, ensuring a structured approach to development.
- **[01-move-frontend-out-of-compilation.md](./01-move-frontend-out-of-compilation.md)**: This task focuses on moving existing frontend components and pages out of the compilation path to prevent build errors during the backend refactor. It details steps for creating an archive directory, moving various frontend GUI components, pages, and libraries, and updating TypeScript and ESLint configurations to exclude the archived frontend, allowing for a clean backend rebuild.
- **[02-delete-playwright-tests.md](./02-delete-playwright-tests.md)**: This document describes the task of removing existing Playwright E2E tests, as the frontend is being completely rebuilt and new tests will be created for the new architecture. It outlines steps for identifying and removing Playwright-related files, updating `package.json` to remove dependencies and scripts, and checking CI/CD configurations, although this task was largely made redundant by the comprehensive frontend archival in Task 01.
- **[03-implement-new-schema.md](./03-implement-new-schema.md)**: This task involves replacing the current Prisma schema with the complete V1.0 schema, including RBAC models, renamed entities (GameTitle→Model, GameInstance→Machine), and new features like Priority and Collections. It details backing up the old schema, implementing the new schema, updating the database, and fixing initial TypeScript compilation errors, laying the foundation for the new backend structure.
- **[04-update-seed-data.md](./04-update-seed-data.md)**: This task focuses on completely rewriting the seed script to work with the new V1.0 schema and RBAC system. It includes creating default RBAC permissions, roles that are automatically created with organizations, and updating all entity references to use the new model names. The objective is to ensure that the database can be properly populated with sample data that aligns with the new schema and authorization structure.
- **[05-rebuild-trpc-authorization.md](./05-rebuild-trpc-authorization.md)**: This task details updating the tRPC authorization middleware to work with the new Role and Permission models, replacing the enum-based system. It involves creating permission checking utilities, updating the tRPC procedures structure to be permission-based, and updating existing router files and manual role checks to use the new RBAC system, ensuring secure and granular access control.
- **[06-update-backend-tests.md](./06-update-backend-tests.md)**: This task focuses on updating all backend tests to work with the new V1.0 schema and RBAC system. It includes fixing TypeScript compilation errors, updating test data creation to reflect the new models and relationships, and ensuring comprehensive coverage of the new permission-based authorization system. This is the final task in the sequence, ensuring the stability and correctness of the refactored backend.
- **[07-fix-issue-history-model.md](./07-fix-issue-history-model.md)**: This task addresses the need to fix the `IssueHistory` model by including missing fields required for proper issue activity tracking and multi-tenancy. Specifically, it adds `organizationId` for tenant isolation and `actorId` to track who performed the action, along with defining an `ActivityType` enum for better type safety and consistency in activity naming. This ensures a complete audit trail and proper filtering of activities by organization.
- **[08-implement-comment-soft-delete.md](./08-implement-comment-soft-delete.md)**: This task implements soft delete functionality for comments to enable a comment cleanup service and proper tracking of comment deletions. It involves updating the `Comment` model with `deletedAt` and `deletedBy` fields, implementing a `CommentCleanupService` to manage the lifecycle of soft-deleted comments, and updating comment queries to exclude soft-deleted entries by default. This enhances data management and audit capabilities.
- **[09-fix-upload-authorization.md](./09-fix-upload-authorization.md)**: This task focuses on replacing placeholder authorization in upload endpoints with proper RBAC system integration to address critical security vulnerabilities. It involves updating the `Attachment` model to include `organizationId` for multi-tenancy, creating a centralized upload authorization utility, and fixing the organization logo and issue attachment upload routes to use the new permission-based system. This ensures secure and properly scoped file uploads.
- **[11-enhance-notification-system.md](./11-enhance-notification-system.md)**: This task enhances the notification system by completing the `Notification` model implementation to support machine owner notifications and future notification features. It involves adding critical fields like `userId`, `type`, `entityId`, and `actionUrl` to the `Notification` model, implementing machine ownership notification preferences, and creating a `NotificationService` and tRPC router to manage notification creation, delivery, and user preferences. This lays the groundwork for a robust and customizable notification system.
